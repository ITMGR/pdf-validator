<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Deploying PDF Validator Web Service - PDF Validator Documentation</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../override.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Deploying PDF Validator Web Service";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> PDF Validator Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">PDF Validation Service Overview</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../architecture/">Architecture of the Core Service</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../policy/">Validation Policy</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../interface_description/">Interface description</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Deploying PDF Validator Web Service</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#deploying-pdf-validator-web-service">Deploying PDF Validator Web Service</a></li>
                
                    <li><a class="toctree-l4" href="#system-requirements">System requirements:</a></li>
                
                    <li><a class="toctree-l4" href="#building-project-manually">Building project manually</a></li>
                
                    <li><a class="toctree-l4" href="#installing-the-pdf-validator-on-ubuntu-1504">Installing the PDF Validator on Ubuntu 15.04</a></li>
                
                    <li><a class="toctree-l4" href="#installing-the-pdf-validator-webapp-with-downloaded-apache-tomcat-for-development">Installing the PDF Validator webapp with downloaded Apache Tomcat for development</a></li>
                
                    <li><a class="toctree-l4" href="#system-checks-after-installation">System checks after installation</a></li>
                
                    <li><a class="toctree-l4" href="#configuring-java-certificate-keystore-location">Configuring Java certificate keystore location</a></li>
                
                    <li><a class="toctree-l4" href="#validation-request-maximum-size-limit">Validation request maximum size limit</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../tsl_downloader/">TSL file loading without internet</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../lotl_keystore/">Generating keystore for LOTL validation (optional)</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../logging/">Logging</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../monitoring/">Monitoring Service</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../testing/">Automation testing</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../issues/">Known Issues</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../appendix/">Appendixes</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">PDF Validator Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Deploying PDF Validator Web Service</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="deploying-pdf-validator-web-service">Deploying PDF Validator Web Service</h1>
<h3 id="system-requirements">System requirements:</h3>
<ul>
<li>At least <strong>2GB of RAM</strong> on machine where the build is executed</li>
<li>Minimum required Java version is <strong>Java 7u80</strong> but Java 8 is
   recommended</li>
<li><strong>Maven 3</strong> to build project manually. (Any minor version update to
   Mave 3 should work.)</li>
<li><strong>Tomcat 7</strong> to run PDF validator web service. (Any minor version
   update to should work.)</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: There are known PowerMock issues when building test JAR files
with Java 7. Therefore, it is required to use the latest Java 7 update.
Currently Java SDK version <strong>1.7.0_80</strong>.</p>
</blockquote>
<h2 id="building-project-manually">Building project manually</h2>
<p>The easiest way to get all required files is to just download the ZIP
file with all the required apps and services. But if You prefer to build
the project manually, then just issue following Maven command:</p>
<h3 id="basic-build-process">Basic build process</h3>
<p>If <code>git</code>, <code>mvn</code> and <code>javac</code> have been installed correctly then You can just issue these commands:</p>
<pre><code class="bash">git clone https://github.com/open-eid/pdf-validator.git --recursive
cd pdf-validator
mvn clean install -Dmaven.test.skip.exec -DargLine=&quot;-Xmx512m&quot;
</code></pre>

<p>Next step is to deploy the build artifacts to Tomcat.</p>
<h3 id="build-process-on-ubuntu-1504">Build process on Ubuntu 15.04</h3>
<p>First we need to install all required software dependencies for that we need 
to issue following commands:</p>
<pre><code class="bash">sudo apt-get update
sudo apt-get install -y git 
sudo apt-get install -y openjdk-7-jdk
sudo apt-get install -y maven
sudo apt-get install -y tomcat7
</code></pre>

<blockquote>
<p><strong>NOTE</strong>: Recommended way of using Tomcat is to download it directly from Apache Tomcat homepage.
Reason for that is to get more platform independent deployment process.</p>
</blockquote>
<p>Next we need to clone the <code>pdf-validator</code> project I chose <code>$HOME</code> directory</p>
<pre><code class="bash">cd $HOME
git clone https://github.com/open-eid/pdf-validator.git --recursive
cd pdf-validator
</code></pre>

<p>Now are ready to build the project by issuing following Maven command</p>
<pre><code class="bash">mvn clean install -Dmaven.test.skip.exec -DargLine=&quot;-Xmx512m&quot;
</code></pre>

<p>We can skip test execution when building because most of the tests are integration tests
and may fail in some cases.</p>
<blockquote>
<p><strong>NOTE</strong>: The computer where maven install command is issued must be
open to the internet. Maven pulls dependencies from several different
repositories.</p>
<p><strong>NOTE:</strong> Joinup Maven repository (http://joinup.ec.europa.eu/site) is
very slow sometimes, so please be patient when building project the
first time.</p>
</blockquote>
<h2 id="installing-the-pdf-validator-on-ubuntu-1504">Installing the PDF Validator on Ubuntu 15.04</h2>
<p>After build has completed successfully we can continue installing the build artifacts
into our Tomcat web container. </p>
<p>First make sure You have installed the Tomcat.</p>
<pre><code class="bash">sudo apt-get update &amp;&amp; sudo apt-get install -y tomcat7
</code></pre>

<p>First we need to create directory where our certificate Java keystore reside in by issuing following 
commands:</p>
<pre><code class="bash">cd /tmp
sudo mkdir cert-store
sudo chown tomcat7:root
sudo chmod 755 cert-store
</code></pre>

<p>Now we need to configure some environment variables to make PDF Validator work correctly.
Make <code>bin</code> directory in <code>$CATALINA_HOME</code> and add <code>setenv.sh</code> file into it.</p>
<blockquote>
<p><strong>NOTE:</strong> Paths below are based on default paths of package manger 
installed version of <strong>Tomcat 7 of Ubuntu 15.04</strong></p>
</blockquote>
<pre><code class="bash">cd /var/lib/tomcat7
sudo mkdir bin 
sudo touch bin/setenv.sh 
</code></pre>

<p>Add following content into this file.</p>
<pre><code>export DSS_DATA_FOLDER=/tmp/cert-store
</code></pre>

<p>Next we need to install the build artifacts into <code>webapps</code> directory:</p>
<pre><code class="bash">cp $HOME/pdf-validator/pdf-validator-parent/pdf-validator-webapp/target/pdf-validator-webapp-*.war /var/lib/tomcat7/webapps
</code></pre>

<blockquote>
<p><strong>NOTE</strong> It would be good to rename the <code>war</code> file to make more usable URL otherwise the version number will be visible in 
URL path</p>
</blockquote>
<p>Now we can start the Tomcat service:</p>
<pre><code class="bash">sudo service tomcat7 restart
</code></pre>

<h2 id="installing-the-pdf-validator-webapp-with-downloaded-apache-tomcat-for-development">Installing the PDF Validator webapp with downloaded Apache Tomcat for development</h2>
<ol>
<li>Navigate the directory that holds the ZIP file (if you built the ZIP
    file using Maven, navigate to
    directory <code>PROJECT_BASE_DIRECTORY/pdf-validator-distribution/target</code>).</li>
<li>
<p>Copy <code>pdf-validator-distribution-1.0.1.RC1-distribution.zip</code> file
    outside <code>PROJECT_BASE_DIRECTORY</code>. ZIP file contents will look like
    the following:</p>
<pre><code>pdf-validator-distribution-1.0.1.RC1-distribution\
└── bin
├── pdf-validator-monitoring-1.0.1.RC1.jar # Monitoring web service (fat JAR)\
├── pdf-validator-tsl-downloader-1.0.1.RC1.jar   # TSL File Downloader when (fat JAR)\
    └── pdf-validator-webapp-1.0.1.RC1.war # PDF Validator webap
</code></pre>
</li>
<li>
<p>Unzip the ZIP-file in directory for example into directory <code>~/pdfvalidator/</code></p>
</li>
<li>
<p>Install Tomcat 7. For a quick manual install, one can use the
    following commands:</p>
<pre><code>curl --remote-name http://www.eu.apache.org/dist/tomcat/tomcat-7/v7.0.64/bin/apache-tomcat-7.0.64.zip
unzip apache-tomcat-7.0.64.zip
</code></pre>
<p>After that the directory should look like so:</p>
<pre><code>pdfvalidator
├── apache-tomcat-7.0.64 - Tomcat 7 Application server
│ ├── bin
│ ├── conf
│ ├── lib
│ ├── LICENSE
│ ├── logs
│ ├── NOTICE
│ ├── RELEASE-NOTES
│ ├── RUNNING.txt
│ ├── temp
│ ├── webapps
│ └── work
└── bin - Unzipped PDF Validator contents
├── pdf-validator-monitoring-1.0.1.RC1.jar
├── pdf-validator-tsl-downloader-1.0.1.RC1.jar
└── pdf-validator-webapp-1.0.1.RC1.war
</code></pre>
</li>
<li>
<p>Create context by issuing following commands relative to
    <code>~/pdfvalidator</code> directory:</p>
<pre><code>mkdir -p apache-tomcat-7.0.64/conf/Catalina/localhost\
touch apache-tomcat-7.0.64/conf/Catalina/localhost/pdf-validator-webapp.xml6.
</code></pre>
</li>
<li>
<p>Copy below contents to <code>pdf-validator-webapp.xml</code></p>
<pre><code>&lt;xml version="1.0" encoding="UTF-8"\&gt;       
&lt;Context path="/pdf-validator-webapp" docBase="/home/vagrant/pdfvalidator/bin/pdf-validator-webapp-1.0.1.RC1.war" /&gt;
</code></pre>
</li>
<li>
<p>Start the web service by issuing following command relative to
<code>~/pdfvalidator</code></p>
<pre><code>./apache-tomcat-7.0.64/bin/startup.sh start
</code></pre>
</li>
<li>
<p>Check that service is running by navigating to URL: <code>http://localhost:8080/pdf-validator-webapp/wservice</code> You should see
list of WSDL endpoints.</p>
</li>
</ol>
<h2 id="system-checks-after-installation">System checks after installation</h2>
<p>After checking logs for errors You can navigate to <code>http://&lt;server-ip&gt;:8080/pdf-validator-webapp-1.0.1.RC1/wservice</code> with browser to 
check if web service has started correctly and see similar web page as shown below.</p>
<p><img alt="WSDL Endpoints after service has started" src="../img/working_web_service.png" /></p>
<h2 id="configuring-java-certificate-keystore-location">Configuring Java certificate keystore location</h2>
<p>When PDF Validator web application starts it creates <code>etc</code> directory relative to path of Tomcat startup script execution 
location. In most of Linux distribution the default solution won't work because of lack of write permissions in startup forlder.</p>
<p>To fix this You need to set environment variable <code>DSS_DATA_FOLDER</code> and make it accessible to Tomcat Web container user.</p>
<!---
Using Nginx reverse proxy in front of PDF Validator web service
---------------------------------------------------------------
-->

<h2 id="validation-request-maximum-size-limit">Validation request maximum size limit</h2>
<p>PDF Validator by default can validate files around <strong>10MB</strong> in size. If there
is need to validate larger files then web service needs to be recompiled. </p>
<p>Steps to change upload limit:</p>
<ol>
<li>Open file <code>PROJECT_BASE_DIRECTORY/pdf-validator-parent/pdf-validator-webservice/src/main/resources/pdf-validator-webservice.xml</code></li>
<li>
<p>Change this below shown section. File size limit is given in bytes.\</p>
<pre><code>    &lt;cxf:bus&gt;
        &lt;cxf:properties&gt;
            &lt;entry key="org.apache.cxf.stax.maxTextLength" value="10000000" /&gt; 
        &lt;/cxf:properties&gt;
    &lt;/cxf:bus&gt;
</code></pre>
</li>
<li>
<p>Save file and recompile the project in the root using <code>./build.sh</code> script</p>
</li>
</ol>
<p>To test file size limit You can submit large files with the following
command (which submits "demo.xml", presumably a large file):</p>
<pre><code class="bash">curl -s -X POST -d &quot;@demo.xml&quot;
http://localhost:8080/pdf-validator-webapp/wservice/validationService\\?wsdl
| xmllint --format - | pygmentize -l xml
</code></pre>

<blockquote>
<p><strong>NOTE</strong>: xmllint and pygmentize maybe required to be installed
separately</p>
</blockquote>
<p>Produced output should look similar to this:</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope&quot;&gt;
    &lt;soap:Body&gt;
        &lt;soap:Fault&gt;
            &lt;faultcode&gt;soap:Client&lt;/faultcode&gt;
             &lt;faultstring&gt;Unmarshalling Error: Text size limit (10000000) exceeded &lt;/faultstring&gt;
         &lt;/soap:Fault&gt;
    &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tsl_downloader/" class="btn btn-neutral float-right" title="TSL file loading without internet"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../interface_description/" class="btn btn-neutral" title="Interface description"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../interface_description/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../tsl_downloader/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
